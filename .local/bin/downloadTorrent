#!/bin/bash

torrents_on_same_file=0
folder_torrents=""
default_route="$HOME/Documents/Torrents/"

while read -r line;
do

	## Ommit comments
	if [[ $line == "#"* ]]; then
		continue
	fi

	if [[ !$torrents_on_same_file ]]; then
		## Directly
		if [[ $line == *' '* ]]; then
			$link_torrent=$(echo "$line" | awk '{print $2}')
			$folder_torrents="$folder_torrents$(echo "$string" | awk '{print $1}')"

			mkdir -p "$folder_torrents"

			qbittorrent-nox --add $link_torrent --savepath $folder_torrents

			echo "File $link_torrent saved on $folder_torrents"

			$link_torrent=""
			$folder_torrents=$default_route
			continue

		## Group of files
		elif [[ $line == *{ && !$torrents_on_same_file ]]; then
			$torrents_on_same_file=1
			$folder_torrents="$folder_torrents${line%%{*}}"
			mkdir -p "$folder_torrents"
			continue
		fi
	else
		## End of group of files
		if [[ $line == } ]]; then
			$folder_torrents=$default_route
			$torrents_on_same_file=0
			continue

		## All torrents for the same folder
		elif [[ $line == $'\t'* ]]; then
			$link_torrent=$(echo "$line" | awk '{print $1}' | tr -d '\t')
			qbittorrent-nox --add $link_torrent --savepath $folder_torrents

			echo "File $link_torrent saved on $folder_torrents"

			$link_torrent=""
			continue
		fi
	fi

	echo "Error on line $line"

done <$1
