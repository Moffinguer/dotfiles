#!/bin/bash

torrents_on_same_file=0
folder_torrents=""
default_route="$HOME/Documents/Torrents/"

for line in $( cat $1 )
do
	$line=$(echo "$line" | awk '{$1=$1};1')

	## Ommit comments
	if [[ $line == "#"* || -z $string ]]; then
		continue
	fi

	if [[ !$torrents_on_same_file ]]; then
		## Directly
		if [[ $line == *' '* ]]; then
			$link_torrent=$(echo "$string" | awk '{print $2}')
			$folder_torrents="$folder_torrents$(echo "$string" | awk '{print $1}')"
			qbittorrent-nox --add $link_torrent --savepath $folder_torrents

			echo "File $link_torrent saved on $folder_torrents"

			$link_torrent=""
			$folder_torrents=$default_route
			continue

		## Group of files
		elif [[ $line == *{ && !$torrents_on_same_file ]]; then
			$torrents_on_same_file=1
			$folder_torrents="$folder_torrents${line%%{*}}"
			continue
		fi
	else
		## End of group of files
		if [[ $line == } ]]; then
			$folder_torrents=$default_route
			$torrents_on_same_file=0
			continue

		## All torrents for the same folder
		elif [[ $line == $'\t'* ]]; then
			$link_torrent=$(echo "$line" | awk '{print $1}' | tr -d '\t')
			qbittorrent-nox --add $link_torrent --savepath $folder_torrents
	
			echo "File $link_torrent saved on $folder_torrents"

			$link_torrent=""
			continue
		fi
	fi

	echo "File $link_torrent not saved on $folder_torrents"

done
